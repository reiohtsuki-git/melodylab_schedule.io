<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š - MelodyLab</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic UI', sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 16px 0;
            margin-bottom: 24px;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
        }
        
        .logo img {
            width: 32px;
            height: 32px;
        }
        
        .logo a {
            font-size: 24px;
            font-weight: 700;
            color: #3a86ff;
            text-decoration: none;
        }
        
        .logo a:hover {
            color: #2260d9;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 12px;
            padding: 8px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .tab {
            flex: 1;
            padding: 12px 16px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab.active {
            background: #3498db;
            color: white;
        }

        .tab:hover:not(.active) {
            background: #ecf0f1;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .card h3 {
            color: #2c3e50;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .weekly-schedule {
            display: grid;
            gap: 16px;
        }

        .day-schedule {
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            overflow: hidden;
            transition: border-color 0.3s;
        }

        .day-schedule.active {
            border-color: #3498db;
        }

        .day-header {
            background: #f8f9fa;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .day-header:hover {
            background: #e9ecef;
        }

        .day-toggle {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #bdc3c7;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .day-toggle.checked {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }

        .time-slots {
            padding: 16px;
            display: none;
        }

        .day-schedule.active .time-slots {
            display: block;
        }

        .time-slot {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .time-input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .calendar-view {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1px;
            background: #ddd;
            border-radius: 8px;
            overflow: hidden;
        }

        .calendar-header {
            background: #34495e;
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 14px;
        }

        .calendar-day {
            background: white;
            min-height: 80px;
            padding: 8px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .calendar-day:hover {
            background: #f8f9fa;
        }

        .calendar-day.other-month {
            background: #f8f9fa;
            color: #bdc3c7;
        }

        .calendar-day.has-lesson {
            background: #e8f4fd;
        }

        .calendar-day.exception {
            background: #ffeaa7;
        }

        .lesson-indicator {
            width: 6px;
            height: 6px;
            background: #3498db;
            border-radius: 50%;
            margin: 2px;
            display: inline-block;
        }

        .exception-indicator {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #2c3e50;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .quick-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .exception-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .exception-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .container {
                padding: 12px;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .calendar-view {
                font-size: 12px;
            }
            
            .calendar-day {
                min-height: 60px;
                padding: 4px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <img src="../music_school_logo_rem.png" alt="Melody Lab Logo" width="32" height="32">
                <a href="index.html">MelodyLab</a>
            </div>
            <h1 style="margin-left: auto; color: #2c3e50;">ğŸ“… ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š</h1>
        </header>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('weekly')">é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</div>
            <div class="tab" onclick="switchTab('calendar')">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</div>
            <div class="tab" onclick="switchTab('exceptions')">ä¾‹å¤–æ—¥è¨­å®š</div>
            <div class="tab" onclick="switchTab('settings')">åŸºæœ¬è¨­å®š</div>
        </div>

        <!-- é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š -->
        <div id="weekly" class="tab-content active">
            <div class="card">
                <h3>ğŸ—“ï¸ é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š</h3>
                <p>ãƒ¬ãƒƒã‚¹ãƒ³ã‚’è¡Œã†æ›œæ—¥ã¨æ™‚é–“ã‚’è¨­å®šã—ã¦ãã ã•ã„</p>
                
                <div class="quick-actions">
                    <button class="btn btn-secondary" onclick="toggleAllDays()">å…¨æ›œæ—¥é¸æŠ/è§£é™¤</button>
                    <button class="btn btn-secondary" onclick="copySchedule()">ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ã‚³ãƒ”ãƒ¼</button>
                    <button class="btn btn-secondary" onclick="clearSchedule()">ã™ã¹ã¦ã‚¯ãƒªã‚¢</button>
                </div>

                <div class="weekly-schedule">
                    <div class="day-schedule" data-day="monday">
                        <div class="day-header" onclick="toggleDay('monday')">
                            <div class="day-toggle" id="toggle-monday">âœ“</div>
                            <strong>æœˆæ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <div class="time-slot">
                                <input type="time" class="time-input" value="09:00">
                                <span>ã€œ</span>
                                <input type="time" class="time-input" value="10:00">
                                <button class="btn btn-danger" onclick="removeTimeSlot(this)">å‰Šé™¤</button>
                            </div>
                            <button class="btn btn-primary" onclick="addTimeSlot('monday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="tuesday">
                        <div class="day-header" onclick="toggleDay('tuesday')">
                            <div class="day-toggle" id="toggle-tuesday"></div>
                            <strong>ç«æ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('tuesday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="wednesday">
                        <div class="day-header" onclick="toggleDay('wednesday')">
                            <div class="day-toggle" id="toggle-wednesday"></div>
                            <strong>æ°´æ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('wednesday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="thursday">
                        <div class="day-header" onclick="toggleDay('thursday')">
                            <div class="day-toggle" id="toggle-thursday"></div>
                            <strong>æœ¨æ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('thursday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="friday">
                        <div class="day-header" onclick="toggleDay('friday')">
                            <div class="day-toggle" id="toggle-friday"></div>
                            <strong>é‡‘æ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('friday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="saturday">
                        <div class="day-header" onclick="toggleDay('saturday')">
                            <div class="day-toggle" id="toggle-saturday"></div>
                            <strong>åœŸæ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('saturday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>

                    <div class="day-schedule" data-day="sunday">
                        <div class="day-header" onclick="toggleDay('sunday')">
                            <div class="day-toggle" id="toggle-sunday"></div>
                            <strong>æ—¥æ›œæ—¥</strong>
                        </div>
                        <div class="time-slots">
                            <button class="btn btn-primary" onclick="addTimeSlot('sunday')">+ æ™‚é–“è¿½åŠ </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º -->
        <div id="calendar" class="tab-content">
            <div class="card">
                <h3>ğŸ“Š ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼è¡¨ç¤º</h3>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                    <button class="btn btn-secondary" onclick="previousMonth()">â€¹ å‰æœˆ</button>
                    <h4 id="current-month">2025å¹´ 5æœˆ</h4>
                    <button class="btn btn-secondary" onclick="nextMonth()">æ¬¡æœˆ â€º</button>
                </div>
                
                <div class="calendar-view" id="calendar-grid">
                    <div class="calendar-header">æ—¥</div>
                    <div class="calendar-header">æœˆ</div>
                    <div class="calendar-header">ç«</div>
                    <div class="calendar-header">æ°´</div>
                    <div class="calendar-header">æœ¨</div>
                    <div class="calendar-header">é‡‘</div>
                    <div class="calendar-header">åœŸ</div>
                    <!-- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®æ—¥ä»˜ã¯JavaScriptã§ç”Ÿæˆ -->
                </div>
                
                <div style="margin-top: 16px; display: flex; gap: 16px; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div class="lesson-indicator"></div>
                        <span>ãƒ¬ãƒƒã‚¹ãƒ³äºˆå®š</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 12px; height: 12px; background: #e74c3c; border-radius: 50%;"></div>
                        <span>ä¾‹å¤–æ—¥</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä¾‹å¤–æ—¥è¨­å®š -->
        <div id="exceptions" class="tab-content">
            <div class="card">
                <h3>ğŸš« ä¾‹å¤–æ—¥è¨­å®š</h3>
                <p>ä¼‘è¬›æ—¥ã‚„ç‰¹åˆ¥ãªæ—¥ç¨‹ã‚’è¨­å®šã§ãã¾ã™</p>

                <div class="form-group">
                    <label class="form-label">æ—¥ä»˜</label>
                    <input type="date" class="form-input" id="exception-date">
                </div>

                <div class="form-group">
                    <label class="form-label">ç¨®é¡</label>
                    <select class="form-select" id="exception-type">
                        <option value="holiday">ä¼‘è¬›æ—¥</option>
                        <option value="special">ç‰¹åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³</option>
                        <option value="time-change">æ™‚é–“å¤‰æ›´</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">ç†ç”±ãƒ»å‚™è€ƒ</label>
                    <input type="text" class="form-input" id="exception-reason" placeholder="ä¾‹ï¼šç¥æ—¥ã®ãŸã‚ã€ç™ºè¡¨ä¼šæº–å‚™ã®ãŸã‚">
                </div>

                <div class="form-group" id="special-time-group" style="display: none;">
                    <label class="form-label">ç‰¹åˆ¥æ™‚é–“</label>
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <input type="time" class="form-input" id="special-start-time">
                        <span>ã€œ</span>
                        <input type="time" class="form-input" id="special-end-time">
                    </div>
                </div>

                <button class="btn btn-primary" onclick="addException()">+ ä¾‹å¤–æ—¥ã‚’è¿½åŠ </button>

                <div class="exception-list" id="exception-list">
                    <div class="exception-item">
                        <div>
                            <strong>2025/05/05</strong> - ä¼‘è¬›æ—¥<br>
                            <small>ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¦ã‚£ãƒ¼ã‚¯ã®ãŸã‚</small>
                        </div>
                        <button class="btn btn-danger" onclick="removeException(this)">å‰Šé™¤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŸºæœ¬è¨­å®š -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h3>âš™ï¸ åŸºæœ¬è¨­å®š</h3>
                
                <div class="form-group">
                    <label class="form-label">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¬ãƒƒã‚¹ãƒ³æ™‚é–“</label>
                    <select class="form-select">
                        <option value="30">30åˆ†</option>
                        <option value="45">45åˆ†</option>
                        <option value="60" selected>60åˆ†</option>
                        <option value="90">90åˆ†</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">ãƒ¬ãƒƒã‚¹ãƒ³é–“ã®ä¼‘æ†©æ™‚é–“</label>
                    <select class="form-select">
                        <option value="5">5åˆ†</option>
                        <option value="10" selected>10åˆ†</option>
                        <option value="15">15åˆ†</option>
                        <option value="20">20åˆ†</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Zoomå€‹äººãƒŸãƒ¼ãƒ†ã‚£ãƒ³ã‚°IDï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
                    <input type="text" class="form-input" placeholder="123-456-7890">
                    <small style="color: #7f8c8d;">è¨­å®šã™ã‚‹ã¨ã€ã™ã¹ã¦ã®ãƒ¬ãƒƒã‚¹ãƒ³ã§åŒã˜Zoomãƒªãƒ³ã‚¯ãŒä½¿ç”¨ã•ã‚Œã¾ã™</small>
                </div>

                <div class="form-group">
                    <label class="form-label">äºˆç´„å—ä»˜æœŸé™</label>
                    <select class="form-select">
                        <option value="1">1æ—¥å‰ã¾ã§</option>
                        <option value="2">2æ—¥å‰ã¾ã§</option>
                        <option value="3" selected>3æ—¥å‰ã¾ã§</option>
                        <option value="7">1é€±é–“å‰ã¾ã§</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-secondary" onclick="goBack()">â† ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹</button>
            <button class="btn btn-success" onclick="saveSchedule()">ğŸ’¾ ä¿å­˜</button>
        </div>
    </div>

    <!-- ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div class="modal" id="day-detail-modal">
        <div class="modal-content">
            <h3 id="modal-title">æ—¥ä»˜è©³ç´°</h3>
            <div id="modal-body">
                <!-- å‹•çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            </div>
            <div style="text-align: right; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentDate = new Date();
        let allDaysSelected = false;

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            generateCalendar();
            setupEventListeners();
        });

        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            
            // é¸æŠã•ã‚ŒãŸã‚¿ãƒ–ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        // æ›œæ—¥åˆ‡ã‚Šæ›¿ãˆ
        function toggleDay(dayName) {
            const dayElement = document.querySelector(`[data-day="${dayName}"]`);
            const toggleElement = document.getElementById(`toggle-${dayName}`);
            
            if (dayElement.classList.contains('active')) {
                dayElement.classList.remove('active');
                toggleElement.textContent = '';
                toggleElement.classList.remove('checked');
            } else {
                dayElement.classList.add('active');
                toggleElement.textContent = 'âœ“';
                toggleElement.classList.add('checked');
            }
        }

        // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆè¿½åŠ 
        function addTimeSlot(dayName) {
            const timeSlotsContainer = document.querySelector(`[data-day="${dayName}"] .time-slots`);
            const addButton = timeSlotsContainer.querySelector('.btn-primary');
            
            const timeSlot = document.createElement('div');
            timeSlot.className = 'time-slot';
            timeSlot.innerHTML = `
                <input type="time" class="time-input" value="09:00">
                <span>ã€œ</span>
                <input type="time" class="time-input" value="10:00">
                <button class="btn btn-danger" onclick="removeTimeSlot(this)">å‰Šé™¤</button>
            `;
            
            timeSlotsContainer.insertBefore(timeSlot, addButton);
        }

        // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆå‰Šé™¤
        function removeTimeSlot(button) {
            button.parentElement.remove();
        }

        // å…¨æ›œæ—¥é¸æŠ/è§£é™¤
        function toggleAllDays() {
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            allDaysSelected = !allDaysSelected;
            
            days.forEach(day => {
                const dayElement = document.querySelector(`[data-day="${day}"]`);
                const toggleElement = document.getElementById(`toggle-${day}`);
                
                if (allDaysSelected) {
                    dayElement.classList.add('active');
                    toggleElement.textContent = 'âœ“';
                    toggleElement.classList.add('checked');
                } else {
                    dayElement.classList.remove('active');
                    toggleElement.textContent = '';
                    toggleElement.classList.remove('checked');
                }
            });
        }

        // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ç”Ÿæˆ
        function generateCalendar() {
            const calendarGrid = document.getElementById('calendar-grid');
            const monthTitle = document.getElementById('current-month');
            
            // ç¾åœ¨ã®æœˆã®æƒ…å ±ã‚’å–å¾—
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            
            monthTitle.textContent = `${year}å¹´ ${month + 1}æœˆ`;
            
            // æ—¢å­˜ã®æ—¥ä»˜ã‚’å‰Šé™¤ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã¯æ®‹ã™ï¼‰
            const existingDays = calendarGrid.querySelectorAll('.calendar-day');
            existingDays.forEach(day => day.remove());
            
            // æœˆã®æœ€åˆã®æ—¥ã¨æœ€å¾Œã®æ—¥ã‚’å–å¾—
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            // 6é€±é–“åˆ†ã®æ—¥ä»˜ã‚’ç”Ÿæˆ
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                // ä»–ã®æœˆã®æ—¥ä»˜
                if (date.getMonth() !== month) {
                    dayElement.classList.add('other-month');
                }
                
                // ãƒ¬ãƒƒã‚¹ãƒ³æ—¥ã®è¡¨ç¤ºï¼ˆã‚µãƒ³ãƒ—ãƒ«ï¼‰
                if (date.getDay() === 1 && date.getMonth() === month) { // æœˆæ›œæ—¥
                    dayElement.classList.add('has-lesson');
                    dayElement.innerHTML += '<div class="lesson-indicator"></div>';
                }
                
                // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                dayElement.addEventListener('click', () => openDayDetail(date));
                
                calendarGrid.appendChild(dayElement);
            }
        }

        // å‰æœˆè¡¨ç¤º
        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            generateCalendar();
        }

        // æ¬¡æœˆè¡¨ç¤º
        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            generateCalendar();
        }

        // æ—¥ä»˜è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ«
        function openDayDetail(date) {
            const modal = document.getElementById('day-detail-modal');
            const title = document.getElementById('modal-title');
            const body = document.getElementById('modal-body');
            
            title.textContent = `${date.getFullYear()}å¹´${date.getMonth() + 1}æœˆ${date.getDate()}æ—¥`;
            
            // ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
            body.innerHTML = `
                <p><strong>ã“ã®æ—¥ã®ãƒ¬ãƒƒã‚¹ãƒ³äºˆå®š:</strong></p>
                <div style="margin: 12px 0;">
                    <div style="padding: 8px; background: #f8f9fa; border-radius: 4px; margin-bottom: 8px;">
                        09:00 - 10:00 ç”°ä¸­ã•ã‚“
                    </div>
                    <div style="padding: 8px; background: #f8f9fa; border-radius: 4px;">
                        15:00 - 16:00 ä½è—¤ã•ã‚“
                    </div>
                </div>
                <button class="btn btn-primary" style="margin-top: 12px;">+ ç‰¹åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³è¿½åŠ </button>
            `;
            
            modal.classList.add('active');
        }

        // ãƒ¢ãƒ¼ãƒ€ãƒ«é–‰ã˜ã‚‹
        function closeModal() {
            document.getElementById('day-detail-modal').classList.remove('active');
        }

        // ä¾‹å¤–æ—¥è¿½åŠ 
        function addException() {
            const date = document.getElementById('exception-date').value;
            const type = document.getElementById('exception-type').value;
            const reason = document.getElementById('exception-reason').value;
            
            if (!date || !reason) {
                alert('æ—¥ä»˜ã¨ç†ç”±ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const exceptionList = document.getElementById('exception-list');
            const exceptionItem = document.createElement('div');
            exceptionItem.className = 'exception-item';
            
            const formatDate = new Date(date).toLocaleDateString('ja-JP');
            const typeText = {
                'holiday': 'ä¼‘è¬›æ—¥',
                'special': 'ç‰¹åˆ¥ãƒ¬ãƒƒã‚¹ãƒ³',
                'time-change': 'æ™‚é–“å¤‰æ›´'
            }[type];
            
            exceptionItem.innerHTML = `
                <div>
                    <strong>${formatDate}</strong> - ${typeText}<br>
                    <small>${reason}</small>
                </div>
                <button class="btn btn-danger" onclick="removeException(this)">å‰Šé™¤</button>
            `;
            
            exceptionList.appendChild(exceptionItem);
            
            // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('exception-date').value = '';
            document.getElementById('exception-reason').value = '';
        }

        // ä¾‹å¤–æ—¥å‰Šé™¤
        function removeException(button) {
            if (confirm('ã“ã®ä¾‹å¤–æ—¥è¨­å®šã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
                button.parentElement.remove();
            }
        }

        // ä¾‹å¤–æ—¥ã‚¿ã‚¤ãƒ—å¤‰æ›´æ™‚ã®å‡¦ç†
        function setupEventListeners() {
            const exceptionType = document.getElementById('exception-type');
            const specialTimeGroup = document.getElementById('special-time-group');
            
            exceptionType.addEventListener('change', function() {
                if (this.value === 'special' || this.value === 'time-change') {
                    specialTimeGroup.style.display = 'block';
                } else {
                    specialTimeGroup.style.display = 'none';
                }
            });
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
            document.getElementById('day-detail-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚³ãƒ”ãƒ¼
        function copySchedule() {
            const scheduleData = gatherScheduleData();
            navigator.clipboard.writeText(JSON.stringify(scheduleData, null, 2))
                .then(() => alert('ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ'))
                .catch(() => alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ'));
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¯ãƒªã‚¢
        function clearSchedule() {
            if (confirm('ã™ã¹ã¦ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®šã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                // å…¨æ›œæ—¥ã‚’éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                days.forEach(day => {
                    const dayElement = document.querySelector(`[data-day="${day}"]`);
                    const toggleElement = document.getElementById(`toggle-${day}`);
                    
                    dayElement.classList.remove('active');
                    toggleElement.textContent = '';
                    toggleElement.classList.remove('checked');
                    
                    // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã‚’ã‚¯ãƒªã‚¢
                    const timeSlots = dayElement.querySelectorAll('.time-slot');
                    timeSlots.forEach(slot => slot.remove());
                });
                
                allDaysSelected = false;
            }
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‡ãƒ¼ã‚¿åé›†
        function gatherScheduleData() {
            const scheduleData = {
                weeklySchedule: {},
                exceptions: [],
                settings: {}
            };
            
            // é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
            const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
            days.forEach(day => {
                const dayElement = document.querySelector(`[data-day="${day}"]`);
                if (dayElement.classList.contains('active')) {
                    const timeSlots = dayElement.querySelectorAll('.time-slot');
                    scheduleData.weeklySchedule[day] = [];
                    
                    timeSlots.forEach(slot => {
                        const startTime = slot.querySelector('.time-input:first-of-type').value;
                        const endTime = slot.querySelector('.time-input:last-of-type').value;
                        scheduleData.weeklySchedule[day].push({
                            start: startTime,
                            end: endTime
                        });
                    });
                }
            });
            
            // ä¾‹å¤–æ—¥
            const exceptionItems = document.querySelectorAll('.exception-item');
            exceptionItems.forEach(item => {
                const text = item.querySelector('div').textContent;
                scheduleData.exceptions.push(text);
            });
            
            return scheduleData;
        }

        // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ä¿å­˜
        function saveSchedule() {
            const scheduleData = gatherScheduleData();
            
            // ã“ã“ã§å®Ÿéš›ã®APIå‘¼ã³å‡ºã—ã‚’è¡Œã†
            console.log('ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿:', scheduleData);
            
            // ä¿å­˜æˆåŠŸã®ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯
            const saveButton = document.querySelector('.btn-success');
            const originalText = saveButton.innerHTML;
            
            saveButton.innerHTML = 'âœ… ä¿å­˜ä¸­...';
            saveButton.disabled = true;
            
            // å®Ÿéš›ã®ä¿å­˜å‡¦ç†ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            setTimeout(() => {
                saveButton.innerHTML = 'âœ… ä¿å­˜å®Œäº†';
                setTimeout(() => {
                    saveButton.innerHTML = originalText;
                    saveButton.disabled = false;
                }, 1000);
            }, 1000);
        }

        // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«æˆ»ã‚‹
        function goBack() {
            if (confirm('å¤‰æ›´ã‚’ä¿å­˜ã›ãšã«æˆ»ã‚Šã¾ã™ã‹ï¼Ÿ')) {
                // å®Ÿéš›ã®å®Ÿè£…ã§ã¯é©åˆ‡ãªURLã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
                window.history.back();
            }
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey || e.metaKey) {
                switch(e.key) {
                    case 's':
                        e.preventDefault();
                        saveSchedule();
                        break;
                    case 'c':
                        if (e.shiftKey) {
                            e.preventDefault();
                            copySchedule();
                        }
                        break;
                }
            }
            
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        // è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
        let autoSaveTimer;
        function setupAutoSave() {
            // å…¥åŠ›è¦ç´ ã®å¤‰æ›´ã‚’ç›£è¦–
            document.addEventListener('input', function() {
                clearTimeout(autoSaveTimer);
                autoSaveTimer = setTimeout(() => {
                    // è‡ªå‹•ä¿å­˜ã®ãƒ­ã‚¸ãƒƒã‚¯
                    console.log('è‡ªå‹•ä¿å­˜å®Ÿè¡Œ');
                }, 30000); // 30ç§’å¾Œã«è‡ªå‹•ä¿å­˜
            });
        }

        // æ™‚é–“ã®å¦¥å½“æ€§ãƒã‚§ãƒƒã‚¯
        function validateTimeSlot(startTime, endTime) {
            if (startTime >= endTime) {
                alert('é–‹å§‹æ™‚é–“ã¯çµ‚äº†æ™‚é–“ã‚ˆã‚Šå‰ã«è¨­å®šã—ã¦ãã ã•ã„');
                return false;
            }
            return true;
        }

        // æ™‚é–“ã‚¹ãƒ­ãƒƒãƒˆã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
        function checkTimeOverlap(dayName) {
            const dayElement = document.querySelector(`[data-day="${dayName}"]`);
            const timeSlots = dayElement.querySelectorAll('.time-slot');
            const times = [];
            
            timeSlots.forEach(slot => {
                const startTime = slot.querySelector('.time-input:first-of-type').value;
                const endTime = slot.querySelector('.time-input:last-of-type').value;
                times.push({ start: startTime, end: endTime });
            });
            
            // é‡è¤‡ãƒã‚§ãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯
            for (let i = 0; i < times.length; i++) {
                for (let j = i + 1; j < times.length; j++) {
                    if (times[i].start < times[j].end && times[j].start < times[i].end) {
                        alert('æ™‚é–“ãŒé‡è¤‡ã—ã¦ã„ã¾ã™ã€‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                        return false;
                    }
                }
            }
            return true;
        }

        // ãƒšãƒ¼ã‚¸é›¢è„±å‰ã®ç¢ºèª
        window.addEventListener('beforeunload', function(e) {
            const hasUnsavedChanges = true; // å®Ÿéš›ã®å®Ÿè£…ã§ã¯å¤‰æ›´ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = '';
            }
        });
    </script>
</body>
</html>
